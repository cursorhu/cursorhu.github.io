<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/my_icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/my_icon/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/my_icon/manifest.json">
  <meta name="msapplication-config" content="/images/my_icon/browserconfig.xml">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cursorhu.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Windows Driver - Visual Studio配置安装VisualStudio+SDK+WDK环境全部流程：https:&#x2F;&#x2F;learn.microsoft.com&#x2F;zh-cn&#x2F;windows-hardware&#x2F;drivers&#x2F;download-the-wdk 注意：WDK安装前要求先安装适配版本的SDK： https:&#x2F;&#x2F;developer.microsoft.com&#x2F;en-us&#x2F;w">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows Driver - Visual Studio配置">
<meta property="og:url" content="https://cursorhu.github.io/2024/08/30/Windows%20Driver%20-%20Visual%20Studio%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="ThinkNotes">
<meta property="og:description" content="Windows Driver - Visual Studio配置安装VisualStudio+SDK+WDK环境全部流程：https:&#x2F;&#x2F;learn.microsoft.com&#x2F;zh-cn&#x2F;windows-hardware&#x2F;drivers&#x2F;download-the-wdk 注意：WDK安装前要求先安装适配版本的SDK： https:&#x2F;&#x2F;developer.microsoft.com&#x2F;en-us&#x2F;w">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408121640199.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408121647174.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271608916.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271036011.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271547361.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271529699.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271544290.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271607797.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271607341.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271630847.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408121042763.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408221950345.png">
<meta property="article:published_time" content="2024-08-30T09:52:38.000Z">
<meta property="article:modified_time" content="2025-11-04T09:28:48.707Z">
<meta property="article:author" content="cursorhu">
<meta property="article:tag" content="windows驱动">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408121640199.png">

<link rel="canonical" href="https://cursorhu.github.io/2024/08/30/Windows%20Driver%20-%20Visual%20Studio%E9%85%8D%E7%BD%AE/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Windows Driver - Visual Studio配置 | ThinkNotes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ThinkNotes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Simple is not easy</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于我</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://cursorhu.github.io/2024/08/30/Windows%20Driver%20-%20Visual%20Studio%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="cursorhu">
      <meta itemprop="description" content="化繁为简，知易行难">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ThinkNotes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Windows Driver - Visual Studio配置
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-08-30 17:52:38" itemprop="dateCreated datePublished" datetime="2024-08-30T17:52:38+08:00">2024-08-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-11-04 17:28:48" itemprop="dateModified" datetime="2025-11-04T17:28:48+08:00">2025-11-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/windows%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">windows驱动开发</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Windows-Driver-Visual-Studio配置"><a href="#Windows-Driver-Visual-Studio配置" class="headerlink" title="Windows Driver - Visual Studio配置"></a>Windows Driver - Visual Studio配置</h1><h2 id="安装VisualStudio-SDK-WDK环境"><a href="#安装VisualStudio-SDK-WDK环境" class="headerlink" title="安装VisualStudio+SDK+WDK环境"></a>安装VisualStudio+SDK+WDK环境</h2><p>全部流程：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/download-the-wdk">https://learn.microsoft.com/zh-cn/windows-hardware/drivers/download-the-wdk</a></p>
<p>注意：WDK安装前要求先安装适配版本的SDK：</p>
<p><a target="_blank" rel="noopener" href="https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/">https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/</a></p>
<p>推荐按以上链接在VS安装程序中安装Windows 11 SDK (10.0.26100.0)，注意默认选中的不是这个版本，需要手动选择这个版本：</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408121640199.png" alt="image-20240812164012107"></p>
<p>正常安装完SDK和WDK后，创建一个KMDF项目是像这样：如果缺少SDK和Driver Setting这些，说明SDK版本不匹配</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408121647174.png" alt="image-20240812164731134"></p>
<p>注意：如果在有问题的环境创建了项目编译会报错，在环境配好后该项目也不能用还是会编译报错，应该删除重新建。</p>
<h2 id="VS2019-SDK-WDK环境"><a href="#VS2019-SDK-WDK环境" class="headerlink" title="VS2019+SDK+WDK环境"></a>VS2019+SDK+WDK环境</h2><p>TODO</p>
<h2 id="搭建DVL环境（for-WHQL）"><a href="#搭建DVL环境（for-WHQL）" class="headerlink" title="搭建DVL环境（for WHQL）"></a>搭建DVL环境（for WHQL）</h2><p>前置环境：Visual Studio 2019 + SDK 22000 + WDK 22000 + 一些MSVC模块 </p>
<p>(Visual Studio 2022 + 24H2 WDK无法正常执行CodeQL(找不到x86\InfVerif.dll)，也没有自带SDV，暂时不用VS2022环境)</p>
<p>DVL：driver verification log</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/develop/creating-a-driver-verification-log">https://learn.microsoft.com/zh-cn/windows-hardware/drivers/develop/creating-a-driver-verification-log</a></p>
<p>The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-hardware/design/compatibility/">Windows Hardware Certification Program</a> requires a driver verification log (DVL) for driver submissions. The DVL contains a summary of the results from static analysis tools, <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/static-tools-and-codeql">CodeQL</a>. The DVL doesn’t contain any source code information. Before creating a DVL for your driver, run CodeQL, the code analysis tool, and static driver verifier. </p>
<p>使用VS2019+WDK，WHQL的DVL生成依赖于三项文件：<img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271608916.png" alt="image-20241227160816886"></p>
<ol>
<li>Code Analysis（CA） log： VS2019 + WDK 环境可以生成</li>
<li>Static Driver Verifier（SDV） log：VS2019 + WDK 环境可以生成</li>
<li>CodeQL Sarif log：需要配置CodeQL环境</li>
</ol>
<p>根据微软的SDV文档（<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/static-driver-verifier%EF%BC%89%EF%BC%9ACodeQL">https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/static-driver-verifier）：CodeQL</a> 和SDV似乎是并列关系，都是静态代码分析，因此VS 2022直接不支持SDV，只推荐CodeQL。但不确定WHQL logo driver是不是必须要SDV，因此还是用VS2019环境以确保DVL需要的三种log都能生成。</p>
<h3 id="配置CodeQL环境"><a href="#配置CodeQL环境" class="headerlink" title="配置CodeQL环境"></a>配置CodeQL环境</h3><p>详细步骤参考：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/static-tools-and-codeql#queries-and-suites">https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/static-tools-and-codeql#queries-and-suites</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/Windows-Driver-Developer-Supplemental-Tools">https://github.com/microsoft/Windows-Driver-Developer-Supplemental-Tools</a></p>
<p>WHQL的OS版本对CodeQL版本的兼容矩阵表：</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271036011.png" alt="image-20241227103629965"></p>
<p>假如要发布24H2的WHQL driver，需要选用红框的版本。按以下几步配置CodeQL环境：</p>
<p>创建CodeQL环境的home目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; mkdir C:\codeql-home</span><br></pre></td></tr></table></figure>

<ol>
<li>下载CodeQL 2.15.4 二进制包</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/github/codeql-cli-binaries/releases/tag/v2.15.4">https://github.com/github/codeql-cli-binaries/releases/tag/v2.15.4</a></p>
<ol start="2">
<li><p>下载Windows Driver Developer Supplemental Tools的WHCP_24H2分支；或者git clone，再checkout到WHCP_24H2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">（1）下载Windows Driver Developer Supplemental Tools的WHCP_24H2分支：</span><br><span class="line">git clone https://github.com/microsoft/Windows-Driver-Developer-Supplemental-Tools.git</span><br><span class="line">git branch -a</span><br><span class="line">git checkout WHCP_24H2</span><br><span class="line">也可以在github页面切换到WHCP_24H2分支后下载压缩包</span><br><span class="line"></span><br><span class="line">（2）查看分支：</span><br><span class="line">C:\codeql-home\Windows-Driver-Developer-Supplemental-Tools&gt;git branch</span><br><span class="line">* WHCP_24H2</span><br><span class="line">  main</span><br></pre></td></tr></table></figure>

<p>注意，不同的分支可能对应不同的<a target="_blank" rel="noopener" href="https://github.com/microsoft/Windows-Driver-Developer-Supplemental-Tools/blob/main/suites/windows_driver_mustfix.qls">windows_driver_mustfix.qls</a></p>
</li>
<li><p>安装CodeQL query packages</p>
<p>如果不安装CodeQL query packages，直接执行codeql analyze会报package缺失，目前我是手动安装package：VS rebuild多次执行后处理脚本RunCodeQLRebuildQuery.bat，每次报错缺什么版本package就装什么，如下图，直到不再报错。</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271547361.png" alt="image-20241227154734283"></p>
<p>安装单个query packages方法：在C:\codeql-home\codeql目录下（包含codeql.exe），执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codeql pack download &lt;package&gt;@&lt;version&gt;</span><br></pre></td></tr></table></figure>

<p>安装所有依赖的query packages过程如下（仅针对CodeQL 2.15.4）：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Package specifications to check for download: codeql/cpp-queries@0.9.0</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/cpp-queries@0.9.0</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;</span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download microsoft/windows-drivers@1.1.0</span><br><span class="line">Package specifications to check for download: microsoft/windows-drivers@1.1.0</span><br><span class="line">Did not need to download any packs.</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Nothing downloaded.</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/cpp-all@0.12.1</span><br><span class="line">Package specifications to check for download: codeql/cpp-all@0.12.1</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/cpp-all@0.12.1 (library)</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;</span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/dataflow@0.1.4</span><br><span class="line">Package specifications to check for download: codeql/dataflow@0.1.4</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/dataflow@0.1.4 (library)</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/rangeanalysis@0.0.3</span><br><span class="line">Package specifications to check for download: codeql/rangeanalysis@0.0.3</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/rangeanalysis@0.0.3 (library)</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/ssa@0.2.4</span><br><span class="line">Package specifications to check for download: codeql/ssa@0.2.4</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/ssa@0.2.4 (library)</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/tutorial@0.2.4</span><br><span class="line">Package specifications to check for download: codeql/tutorial@0.2.4</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/tutorial@0.2.4 (library)</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/util@0.2.4</span><br><span class="line">Package specifications to check for download: codeql/util@0.2.4</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/util@0.2.4 (library)</span><br><span class="line"></span><br><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/typetracking@0.2.4</span><br><span class="line">Package specifications to check for download: codeql/typetracking@0.2.4</span><br><span class="line">Package install location: C:\Users\thomas.hu.O2\.codeql\packages</span><br><span class="line">Installed fresh codeql/typetracking@0.2.4 (library)</span><br></pre></td></tr></table></figure>

<p>有时候网络不好下载失败，换个时间多次重试直到安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\codeql-home\codeql&gt;codeql pack download codeql/cpp-queries@0.9.0</span><br><span class="line">Package specifications to check for download: codeql/cpp-queries@0.9.0</span><br><span class="line">A fatal error occurred: Error downloading blob.</span><br><span class="line">(eventual cause: SocketTimeoutException &quot;Read timed out&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="CodeQL生成-sarif"><a href="#CodeQL生成-sarif" class="headerlink" title="CodeQL生成.sarif"></a>CodeQL生成.sarif</h3><p>(1) 使用.BAT（参考 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/static-tools-and-codeql#queries-and-suites">https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/static-tools-and-codeql#queries-and-suites</a>  7. Visual Studio Post-Build Event (Optional)）</p>
<p>(2) RunCodeQLRebuildQuery.bat内容如下：</p>
<p>​    功能：在C:\codeql-home创建空目录databases，再执行codeql create database和codeql analyze database，其中codeql analyze database依赖于前面的CodeQL query packages和Windows Driver Developer Supplemental Tools。最后输出kmdf.sarif。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ECHO &quot;&gt;&gt;&gt; Running CodeQL Security Rule V 1.0 &lt;&lt;&lt;&quot;</span><br><span class="line">ECHO &quot;Current directory:&quot; %cd%</span><br><span class="line"></span><br><span class="line">set HOME=C:\codeql-home</span><br><span class="line">set SRC=%cd%</span><br><span class="line"></span><br><span class="line">ECHO &quot;&gt;&gt;&gt; Removing previously created rules database &lt;&lt;&lt;&quot;</span><br><span class="line">if exist %HOME%\databases (</span><br><span class="line">	rmdir /s/q %HOME%\databases</span><br><span class="line">)</span><br><span class="line">mkdir %HOME%\databases</span><br><span class="line"></span><br><span class="line">ECHO &quot;&gt;&gt;&gt; codeql create database &lt;&lt;&lt;&quot;</span><br><span class="line">%HOME%\codeql\codeql database create &quot;%HOME%\databases&quot; -l=cpp -s=%SRC% -c &quot;msbuild %SRC%\bhtpcr.sln /p:Configuration=Win8.1Release /p:Platform=ARM64 /t:rebuild /p:PostBuildEventUseInBuild=false&quot;</span><br><span class="line">::ECHO &quot;&gt;&gt;&gt; codeql analyze database &lt;&lt;&lt;&quot;</span><br><span class="line">::codeql database analyze &lt;path to database&gt; &lt;path to query suite .qls file&gt;</span><br><span class="line">CALL %HOME%\codeql\codeql database analyze --download &quot;%HOME%\databases&quot; &quot;%HOME%\Windows-Driver-Developer-Supplemental-Tools\suites\windows_driver_mustfix.qls&quot; --format=sarifv2.1.0 --output=%HOME%\databases\kmdf.sarif --rerun</span><br><span class="line"></span><br><span class="line">ECHO &quot;&gt;&gt;&gt; Loading SARIF Results in Visual Studio &lt;&lt;&lt;&quot;</span><br><span class="line">CALL devenv /Edit %HOME%\databases\kmdf.sarif</span><br><span class="line">SET ERRORLEVEL = 0</span><br></pre></td></tr></table></figure>

<p>(3) 设置项目后处理脚本为RunCodeQLRebuildQuery.bat，并使能，如下图：</p>
<p>这个示例RunCodeQLRebuildQuery.bat位置是.vcxproj的上级目录，也可以放同级目录，不需要加..\</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271529699.png" alt="image-20241227152914648"></p>
<p>(4)运行项目rebuild，编译后会运行RunCodeQLRebuildQuery.bat，正常结果显示success，并能看到kmdf.sarif文件，如下图。如果有错一般是前面的query依赖库没装好，或者VS+WDK版本不兼容。</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271544290.png" alt="image-20241227154401168"></p>
<p>(5) 最后将C:\codeql-home\databases\kmdf.sarif拷贝到Driver的vcproj目录，后面的DVL生成会用到。</p>
<p>(6) RunCodeQLRebuildQuery.bat的调试经验：</p>
<p>如果找不到msbuild，需要将msbuild.exe的路径加到系统PATH，例如（D:\Program Files\Microsoft Visual Studio\2019\Community\MSBuild\Current\Bin）</p>
<p>中文系统上执行msbuild可能输出乱码，CMD中设置中文编码支持：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001</span><br></pre></td></tr></table></figure>

<h3 id="运行SDV和Code-Analysis，生成DVL"><a href="#运行SDV和Code-Analysis，生成DVL" class="headerlink" title="运行SDV和Code Analysis，生成DVL"></a>运行SDV和Code Analysis，生成DVL</h3><p>（1）生成SDV：VS2019 + WDK 22000安装后自带SDV（Static Driver Verifier）</p>
<p>VS2019 -&gt; Extension -&gt; Driver -&gt; Launch Static Driver Verifier</p>
<p>默认选择must fix项，但WHQL的HLK并不需要测所有，也不要求测试项必须通过，因此也可以选择default，或者自定义只测一项nullcheck。</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271607797.png" alt="image-20241227160707770"></p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271607341.png" alt="image-20241227160717317"></p>
<p>（2）生成CA：VS2019 -&gt; Analyze -&gt; Run code analysis -&gt; Run code analysis on bhtsddr</p>
<p>（3）生成kmdf.sarif：已在项目目录下</p>
<p>（4）生成DVL：VS2019 -&gt; Extension -&gt; Driver -&gt; Create driver verification log</p>
<p>显示三种依赖log都detected，Create有警告无所谓，在项目目录下有DriverName.DVL.XML文件生成</p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202412271630847.png" alt="image-20241227163042814"></p>
<p>DVL示例内容如下（SDV和CA有fail，但不影响WHQL HLK）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;Data&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.XMLTimeStamp&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;12/27/2024 15:54:26&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.DriverBinary&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;bhtsdhubdr.sys&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.BinaryTimeStamp&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;01/01/1601 08:00:00&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.DriverType&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;generic&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.DriverSize&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;LOC&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.DriverVersion&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;0&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.Libs&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;Number of external libraries used&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.SDV.Version&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;sdv-2021-03-16&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.SDV.ActiveRuleTotal&quot; ScoreValue=&quot;4&quot; ScoreUnit=&quot;Total rules available&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.SDV.Rule.nullcheck&quot; ScoreValue=&quot;1&quot; ScoreUnit=&quot;SDV_FAILED&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.CodeAnalysis.Summary&quot; ScoreValue=&quot;2&quot; ScoreUnit=&quot;Types of defects seen&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.CodeAnalysis.Defect.6385&quot; ScoreValue=&quot;1&quot; ScoreUnit=&quot;CA_FAILED&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.CodeAnalysis.Defect.6001&quot; ScoreValue=&quot;1&quot; ScoreUnit=&quot;CA_MUSTFIX_FAILED&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.Semmle.Summary&quot; ScoreValue=&quot;1&quot; ScoreUnit=&quot;Types of defects seen&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.Semmle.Defect.cpp/comparison-with-wider-type&quot; ScoreValue=&quot;0&quot; ScoreUnit=&quot;SEMMLE_FAILED&quot;/&gt;</span><br><span class="line">&lt;AssessmentScore ScoreName=&quot;bhtsdhubdr.arm64.General.Checksum&quot; ScoreValue=&quot;4TYw1CLepWklxyssSBb7x9m/tAtAuZozCUvaOq7od2SAQZx6SRlBzEK1wIlqB34JiwSni1qyOrcXYr3C3mrXTA==&quot; ScoreUnit=&quot;DVL Checksum Value&quot;/&gt;</span><br><span class="line">&lt;/Data&gt;</span><br></pre></td></tr></table></figure>

<p>WHQL的HLK测试会用到此DVL文件。</p>
<h2 id="代码新项目相关的配置"><a href="#代码新项目相关的配置" class="headerlink" title="代码新项目相关的配置"></a>代码新项目相关的配置</h2><h3 id="VisualStudio新项目环境配置"><a href="#VisualStudio新项目环境配置" class="headerlink" title="VisualStudio新项目环境配置"></a>VisualStudio新项目环境配置</h3><h4 id="使用VSCode快捷键"><a href="#使用VSCode快捷键" class="headerlink" title="使用VSCode快捷键"></a>使用VSCode快捷键</h4><p>工具–&gt;选项-&gt;键盘-&gt;键盘映射方案选VSCode</p>
<h4 id="WDF项目找不到头文件问题"><a href="#WDF项目找不到头文件问题" class="headerlink" title="WDF项目找不到头文件问题"></a>WDF项目找不到头文件问题</h4><ol>
<li>找不到&lt;ntddk.h&gt;和&lt;wdf.h&gt;</li>
</ol>
<p>在项目配置-&gt; C&#x2F;C++ -&gt; General -&gt; Additional Include Directories -&gt; 加上WDK和WDF的include头文件路径</p>
<p>Ntddk.h contains core Windows kernel definitions for all drivers, while Wdf.h<br>contains definitions for drivers based on the Windows Driver Framework (WDF).  </p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408121042763.png" alt="image-20240812104158672"></p>
<p>注意WDF的版本，Win11选WDF 1.33，参考：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/wdf/kmdf-version-history">https://learn.microsoft.com/zh-cn/windows-hardware/drivers/wdf/kmdf-version-history</a></p>
<ol start="2">
<li>找不到device.tmh</li>
</ol>
<p>项目设置 -&gt; WPP Tracing -&gt; 设置 “Run Wpp Tracing” 为 YES</p>
<h4 id="WDF项目找不到链接symbol"><a href="#WDF项目找不到链接symbol" class="headerlink" title="WDF项目找不到链接symbol"></a>WDF项目找不到链接symbol</h4><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/cpp/error-messages/tool-errors/linker-tools-error-lnk2019?view=msvc-170#third-party-library-issues-and-vcpkg">https://learn.microsoft.com/en-us/cpp/error-messages/tool-errors/linker-tools-error-lnk2019?view=msvc-170#third-party-library-issues-and-vcpkg</a></p>
<p>如果是调用第三方库API报此问题，基本上是项目配置没有链接这个库</p>
<p>The object file or library that contains the definition of the symbol isn’t linked</p>
<p>以SDBUS驱动为例，ntddsd.h定义的SdBusSubmitRequest只有declaration，其函数体实现其实是在SDBUS.lib里，用everything搜索此lib（WDK路径），加到项目配置的Link dependence lib（Link -&gt; Input -&gt; Additional Dependence），即可编译通过。</p>
<p>The <em>ntddsd.h</em> header file, which is provided in the Windows Driver Kit (WDK), declares the prototypes for the routines exposed by the SD bus library.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/sd/sd-card-driver-stack">https://learn.microsoft.com/en-us/windows-hardware/drivers/sd/sd-card-driver-stack</a></p>
<p><img src="https://raw.githubusercontent.com/cursorhu/blog-images-on-picgo/master/images/202408221950345.png" alt="image-20240822195016239"></p>
<p>另外一个示例：</p>
<p>RtlStringCbVPrintfA打印函数属于ntstrsafe.h定义，其lib同名，位于WDK的km目录；一般WDF驱动把km和kmdf的.lib都加到项目的linker路径：（Link -&gt; Input -&gt; Additional Dependence）</p>
<p>注意需要指定到.lib文件名，一般是用到哪个lib才链接哪个lib；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files (x86)\Windows Kits\10\Lib\10.0.26100.0\km\x64\ntstrsafe.lib</span><br></pre></td></tr></table></figure>

<p>也可以用*匹配所有lib：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files (x86)\Windows Kits\10\Lib\10.0.26100.0\km\x64\*.lib</span><br><span class="line">C:\Program Files (x86)\Windows Kits\10\Lib\wdf\kmdf\x64\1.33\*.lib</span><br></pre></td></tr></table></figure>

<h4 id="VS-Code配置项目包含WDF-WDM头文件"><a href="#VS-Code配置项目包含WDF-WDM头文件" class="headerlink" title="VS Code配置项目包含WDF&#x2F;WDM头文件"></a>VS Code配置项目包含WDF&#x2F;WDM头文件</h4><p>在.vscode的c_cpp_properties.json添加WDF&#x2F;WDM所在的头文件定义（即前面VisualStudio添加的Additional Include Directories），在WDK目录，用everything搜索wdf.h和wdm.h所在的目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;includePath&quot;: [</span><br><span class="line">                &quot;$&#123;workspaceFolder&#125;/**&quot;,</span><br><span class="line">                &quot;C:\\Program Files (x86)\\Windows Kits\\10\\Include\\wdf\\kmdf\\1.15&quot;,</span><br><span class="line">                &quot;C:\\Program Files (x86)\\Windows Kits\\10\\Include\\10.0.26100.0\\km&quot;,</span><br><span class="line">            ],</span><br></pre></td></tr></table></figure>

<p>注意上图windows路径需要将单斜杠全局替换成双斜杠，空格不需要加反斜杠</p>
<p>替换完毕查看是否能跳转，例如单击WdfIoQueueCreate能跳转到wdfio.h的函数体定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">_Must_inspect_result_</span><br><span class="line">_IRQL_requires_max_(DISPATCH_LEVEL)</span><br><span class="line">NTSTATUS</span><br><span class="line">FORCEINLINE</span><br><span class="line">WdfIoQueueCreate(</span><br><span class="line">    _In_</span><br><span class="line">    WDFDEVICE Device,</span><br><span class="line">    _In_</span><br><span class="line">    PWDF_IO_QUEUE_CONFIG Config,</span><br><span class="line">    _In_opt_</span><br><span class="line">    PWDF_OBJECT_ATTRIBUTES QueueAttributes,</span><br><span class="line">    _Out_opt_</span><br><span class="line">    WDFQUEUE* Queue</span><br><span class="line">    )</span><br><span class="line">&#123;</span><br><span class="line">    return ((PFN_WDFIOQUEUECREATE) WdfFunctions[WdfIoQueueCreateTableIndex])(WdfDriverGlobals, Device, Config, QueueAttributes, Queue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="代码中支持中文编码"><a href="#代码中支持中文编码" class="headerlink" title="代码中支持中文编码"></a>代码中支持中文编码</h4><p>Warning C4819 The file contains a character that cannot be represented in the current code page (936). Save the file in Unicode format to prevent data loss</p>
<p>这个警告是关于代码页(code page)编码的问题。警告 C4819 表示文件中包含无法在当前代码页(936,即GBK编码)中表示的字符。</p>
<p>解决这个问题有以下几种方法:</p>
<ol>
<li>最推荐的方法是将文件保存为 UTF-8 with BOM 格式:</li>
</ol>
<ul>
<li>在 Visual Studio 中打开文件</li>
<li>点击”文件” -&gt; “高级保存选项”</li>
<li>在编码下拉框中选择”UTF-8 with signature (Codepage 65001)”</li>
<li>点击保存</li>
</ul>
<ol start="2">
<li>如果需要保持当前编码,可以在文件开头添加编码指示:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#pragma code_page(65001)  // 使用 UTF-8 编码</span><br><span class="line">// ... 其余代码 ...</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>也可以在项目设置中修改:</li>
</ol>
<ul>
<li>右键项目 -&gt; 属性</li>
<li>C&#x2F;C++ -&gt; 命令行</li>
<li>在”其他选项”中添加 <code>/utf-8</code></li>
</ul>
<p>尝试过最有效的是方法3，但需要注意 Release和Debug的项目配置是独立的，需要配置两次&#x2F;utf-8</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/windows%E9%A9%B1%E5%8A%A8/" rel="tag"># windows驱动</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/08/30/Windows%20Driver%20--%20INF%20Verifier%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/" rel="prev" title="Windows Driver -- INF Verifier使用笔记">
      <i class="fa fa-chevron-left"></i> Windows Driver -- INF Verifier使用笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/08/30/UEFI%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%9F%A5%E8%AF%86%E5%92%8C%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="next" title="UEFI开发（二）">
      UEFI开发（二） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-Driver-Visual-Studio%E9%85%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">Windows Driver - Visual Studio配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85VisualStudio-SDK-WDK%E7%8E%AF%E5%A2%83"><span class="nav-number">1.1.</span> <span class="nav-text">安装VisualStudio+SDK+WDK环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VS2019-SDK-WDK%E7%8E%AF%E5%A2%83"><span class="nav-number">1.2.</span> <span class="nav-text">VS2019+SDK+WDK环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%AD%E5%BB%BADVL%E7%8E%AF%E5%A2%83%EF%BC%88for-WHQL%EF%BC%89"><span class="nav-number">1.3.</span> <span class="nav-text">搭建DVL环境（for WHQL）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AECodeQL%E7%8E%AF%E5%A2%83"><span class="nav-number">1.3.1.</span> <span class="nav-text">配置CodeQL环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CodeQL%E7%94%9F%E6%88%90-sarif"><span class="nav-number">1.3.2.</span> <span class="nav-text">CodeQL生成.sarif</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8CSDV%E5%92%8CCode-Analysis%EF%BC%8C%E7%94%9F%E6%88%90DVL"><span class="nav-number">1.3.3.</span> <span class="nav-text">运行SDV和Code Analysis，生成DVL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%96%B0%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.</span> <span class="nav-text">代码新项目相关的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VisualStudio%E6%96%B0%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.1.</span> <span class="nav-text">VisualStudio新项目环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8VSCode%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">使用VSCode快捷键</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WDF%E9%A1%B9%E7%9B%AE%E6%89%BE%E4%B8%8D%E5%88%B0%E5%A4%B4%E6%96%87%E4%BB%B6%E9%97%AE%E9%A2%98"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">WDF项目找不到头文件问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WDF%E9%A1%B9%E7%9B%AE%E6%89%BE%E4%B8%8D%E5%88%B0%E9%93%BE%E6%8E%A5symbol"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">WDF项目找不到链接symbol</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VS-Code%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE%E5%8C%85%E5%90%ABWDF-WDM%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.1.4.</span> <span class="nav-text">VS Code配置项目包含WDF&#x2F;WDM头文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E7%BC%96%E7%A0%81"><span class="nav-number">1.4.1.5.</span> <span class="nav-text">代码中支持中文编码</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="cursorhu"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">cursorhu</p>
  <div class="site-description" itemprop="description">化繁为简，知易行难</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">114</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/cursorhu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cursorhu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2449055512@qq.com" title="E-Mail → mailto:2449055512@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cursorhu</span>
</div>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
